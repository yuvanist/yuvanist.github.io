<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>The One With Better Django Queries - DG's Blog and Portfolio</title><meta name=Description content="Ramblings on tech, chess, finance and web3"><meta property="og:title" content="The One With Better Django Queries"><meta property="og:description" content="Okay, It has to be said first. Django is one of the prettiest framework you could work with. It offeres everthing under the hood, but as Uncle Ben used to say,
 With great power there must also come great responsibility
 Not using things properly or the right way could cause lot of issues. So let&rsquo;s go ahead and see some Django queries and how it performs on different conditions."><meta property="og:type" content="article"><meta property="og:url" content="https://yuvanist.github.io/tech/the-one-with-better-django-queries/"><meta property="og:image" content="https://yuvanist.github.io/logo.png"><meta property="article:section" content="tech"><meta property="article:published_time" content="2022-04-16T01:11:56+05:30"><meta property="article:modified_time" content="2022-04-16T01:11:56+05:30"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://yuvanist.github.io/logo.png"><meta name=twitter:title content="The One With Better Django Queries"><meta name=twitter:description content="Okay, It has to be said first. Django is one of the prettiest framework you could work with. It offeres everthing under the hood, but as Uncle Ben used to say,
 With great power there must also come great responsibility
 Not using things properly or the right way could cause lot of issues. So let&rsquo;s go ahead and see some Django queries and how it performs on different conditions."><meta name=application-name content="DG's Blog and Portfolio"><meta name=apple-mobile-web-app-title content="DG's Blog and Portfolio"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://yuvanist.github.io/tech/the-one-with-better-django-queries/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"The One With Better Django Queries","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/yuvanist.github.io\/tech\/the-one-with-better-django-queries\/"},"genre":"tech","keywords":"django, query, python, performance, scaling","wordcount":1980,"url":"https:\/\/yuvanist.github.io\/tech\/the-one-with-better-django-queries\/","datePublished":"2022-04-16T01:11:56+05:30","dateModified":"2022-04-16T01:11:56+05:30","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"DG"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"light"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"light"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="DG's Blog and Portfolio">The One Where I Write Things!</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/ title="The One Where You Go Home :)">Home </a><a class=menu-item href=/tech/ title="The One Where I Write About Tech!">Tech Stuff </a><a class=menu-item href=/random/ title="The One Where I Write About Random Things!">Random Thoughts </a><a class=menu-item href=/traveldump/ title="The One Where I Post Images Of Places I've Been">Travel Dump </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="The One Where You Search Anything!" id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="The One Where You Switch Theme"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="DG's Blog and Portfolio">The One Where I Write Things!</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="The One Where You Search Anything!" id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/ title="The One Where You Go Home :)">Home</a><a class=menu-item href=/tech/ title="The One Where I Write About Tech!">Tech Stuff</a><a class=menu-item href=/random/ title="The One Where I Write About Random Things!">Random Thoughts</a><a class=menu-item href=/traveldump/ title="The One Where I Post Images Of Places I've Been">Travel Dump</a><a href=javascript:void(0); class="menu-item theme-switch" title="The One Where You Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class="page single special"><h1 class="single-title animated pulse faster">The One With Better Django Queries</h1><div class=content id=content><p>Okay, It has to be said first. Django is one of the prettiest framework you could work with. It offeres everthing under the hood, but as Uncle Ben used to say,</p><blockquote><p>With great power there must also come great responsibility</p></blockquote><p>Not using things properly or the right way could cause lot of issues. So let&rsquo;s go ahead and see some Django queries and how it performs on different conditions.</p><p>All the Django Queries discussed below are applied on the <strong>Benchmark</strong> table which has no Index. Here is the structure of it.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=k>class</span> <span class=nc>Benchmark</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>knowledge_begin_date</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>DateTimeField</span><span class=p>(</span><span class=n>null</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>knowledge_end_date</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>DateTimeField</span><span class=p>(</span><span class=n>null</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>client_id</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>IntegerField</span><span class=p>(</span><span class=n>null</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>databook_id</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>UUIDField</span><span class=p>(</span><span class=n>null</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>datasheet_id</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>UUIDField</span><span class=p>(</span><span class=n>null</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=n>JSONField</span><span class=p>(</span><span class=n>null</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>encoder</span><span class=o>=</span><span class=n>DjangoJSONEncoder</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>Incase, if you wanted to play around the table, you can clone the Django App <a href=https://github.com/yuvanist/django-app-to-test-queries target=_blank rel="noopener noreffer">here</a></p><p>I have inserted 2 Million records into the DB table before firing the queries. You can downlad the table <a href="https://drive.google.com/drive/folders/1AgWlTMV5Vg5s9OglVHa7AtXDau1s3FPI?usp=sharing" target=_blank rel="noopener noreffer">here</a>. To insert more rows you can use the script from the git repo mentioned above.</p><h2 id=1-difference-between-only-defer-values-and-values_list>1. Difference between only, defer, values and values_list</h2><p>Let&rsquo;s understand this four things with a single objective query. We have to get all the Unique databook_ids from our table. That&rsquo;s it. That&rsquo;s all we have to do.</p><h4 id=using-only>Using .only</h4><p>.only() in Django helps you to take only the selected columns from your Model. Consider a fat model with tons of columns, will be a huge overhead to fetch entire object instead of what you need.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=n>benchmark_objects</span> <span class=o>=</span> <span class=n>Benchmark</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>only</span><span class=p>(</span><span class=s1>&#39;databook_id&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>unique_databook_ids</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>each_object</span> <span class=ow>in</span> <span class=n>benchmark_objects</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>unique_databook_ids</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>each_object</span><span class=o>.</span><span class=n>databook_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>benchmark_objects</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Not able to access data&#39;</span><span class=p>)</span> 
</span></span></code></pre></td></tr></table></div></div><p>We took all the object but only with the <em>&ldquo;databook_id&rdquo;</em> column. This is far better than fetching entire object and iterating over it for <em>&ldquo;databook_id&rdquo;</em>.</p><p>Now let&rsquo;s look close at the <em>&ldquo;try-and-except&rdquo;</em> block. Here I was trying to access the column <em>&ldquo;data&rdquo;</em> which I didn&rsquo;t fetch.
If you have thought Django would throw Exception for doing this, don&rsquo;t worry. you are not alone. I also thought the same at first. But interestingly what happens is One more query will be fired and the data column will be fetched from the table. So there won&rsquo;t be any Exception. weird, right?</p><p>Now coming to the time part, It took <strong>23.72 Seconds</strong> in my machine to run this block. Costly. I know.</p><h3 id=using-defer>Using .defer()</h3><p>Similar to .only() but instead of taking only that column, it fetches everything apart from what specified in .defer().</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=n>benchmark_objects</span> <span class=o>=</span> <span class=n>Benchmark</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>defer</span><span class=p>(</span><span class=s1>&#39;data&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>unique_databook_ids</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>each_object</span> <span class=ow>in</span> <span class=n>benchmark_objects</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>unique_databook_ids</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>each_object</span><span class=o>.</span><span class=n>databook_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>benchmark_objects</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Not able to access data&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>Nothing fancy here, same as above, take object without <em>data</em> column which is a JSON field and iterate over it for <em>databook_id</em>.
Again, look closely on the <em>&ldquo;try-and-except&rdquo;</em> block statement, if you had thought atleast here Django would throw Exception.</p><div class=tenor-gif-embed data-postid=18429137 data-share-method=host data-aspect-ratio=1.5 data-width=50%><a href=https://tenor.com/view/sorry-arnab-i-am-sorry-i-am-sorry-babu-gif-18429137>Sorry Arnab GIF</a>from <a href=https://tenor.com/search/sorry-gifs>Sorry GIFs</a></div><script type=text/javascript async src=https://tenor.com/embed.js></script><p>Django will fire one more query and fetch <em>data</em> column.
This block took whopping <strong>41 Seconds</strong> to execute. which is understandable, considering the fact it is fetching all other columns apart from <em>data</em>.</p><h3 id=using-values>using .values()</h3><p>If you check .only() and .defer(), you can see that the return type is Object. That&rsquo;s why we were accessing it as <em>object.column_name</em>. .values() will return a dictionary instead of a table object. It also allows to select only the set of columns we need to fetch from the table.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=n>benchmark_objects</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>Benchmark</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>values</span><span class=p>(</span><span class=s1>&#39;databook_id&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>unique_databook_ids</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>each_object</span> <span class=ow>in</span> <span class=n>benchmark_objects</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>unique_databook_ids</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>each_object</span><span class=p>[</span><span class=s1>&#39;databook_id&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>benchmark_objects</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=s1>&#39;data&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Exception: Data is not accessible here&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>A list of dictionaries will be stored in <em>benchmark_objects</em> and we are iterating over the list to fetch <em>databook_id</em>
This block took <strong>10.5 Seconds</strong> to execute. which is much better than the previous two.</p><h3 id=using-values_listflattrue>using .values_list(flat=True)</h3><p>Cool method. just returns the &ldquo;databook_id&rdquo; as a flat list. Removing the <em>flat=True</em> would give list of tuple.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=n>unique_databook_ids</span> <span class=o>=</span> <span class=nb>set</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>Benchmark</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>values_list</span><span class=p>(</span><span class=s2>&#34;databook_id&#34;</span><span class=p>,</span> <span class=n>flat</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>It executed in <strong>6.72 Seconds</strong>.
Okay, Okay, I hear you. This is also slow. But did you see something, which is common in all the four blocks above?</p><p>We took all the objects from the table and added it to <em>set</em>. What if table does that thing instead of us, what would be the performance improvement then?</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=n>unique_databook_ids</span> <span class=o>=</span> <span class=nb>set</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>Benchmark</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>values_list</span><span class=p>(</span><span class=s2>&#34;databook_id&#34;</span><span class=p>,</span> <span class=n>flat</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span><span class=o>.</span><span class=n>distinct</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>Just added <strong>.distinct()</strong> to the query. So the table does the unique filtering. Interestingly, it took only <strong>0.8 Seconds</strong> to execute the block.</p><p>If you have read till now, Thank you and I&rsquo;m jealous of you. I would never read any blogs fully. You have nice attention span!</p><p>Coming back, Remember how we were doing this same operation in the span of 40 seconds or 30 seconds. Now we did the same thing under 1 second.</p><blockquote><p>Things to Note:</p><ol><li>Take only what you need from the table. Don&rsquo;t be greedy.</li><li>Do it in table if you can, if there is no way then use Python vannilla function.</li></ol></blockquote><h2 id=2-dont-bring-knife-to-gun-fight>2. Don&rsquo;t bring Knife to Gun fight.</h2><p>Suppose you have to write a block of code which exectues only when there is particular entry is available in table, we can obviously do this in multiple ways. Like,</p><ol><li>Filtering out all the entries with our condition and applying <strong>len()</strong> function on it.</li><li>Filter and do <strong>.count()</strong> on the query, which returns the number of entries which match our condition.</li></ol><p>As a wise person, you followed second option remembering what we discussed before ie, <strong>Do it in table if you can</strong>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=n>db_ds_objects</span> <span class=o>=</span> <span class=n>Benchmark</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>databook_id</span><span class=o>=</span><span class=s2>&#34;61722a62-fe71-44df-86a5-477bcdfbd91c&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span><span class=o>.</span><span class=n>count</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>db_ds_objects</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Yes, one object with this condition exist&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>It took <strong>0.3 Seconds</strong> execute this block. Not bad right? But wait. Here count is redundant part, we really wanted to know if there exist only one instance where our condition satisfies. That&rsquo;s where <strong>.exist()</strong> method helps.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=n>db_ds_objects</span> <span class=o>=</span> <span class=n>Benchmark</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>databook_id</span><span class=o>=</span><span class=s2>&#34;61722a62-fe71-44df-86a5-477bcdfbd91c&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span><span class=o>.</span><span class=n>exists</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>db_ds_objects</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Yes, this object exist&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>Does the same thing as the previous block at the expense of <strong>0.03 Seconds</strong>. That&rsquo;s whopping 100% or 1000% percent reduction in runtime. I know I&rsquo;m bad at math 😕</p><p>You may ask <em>&ldquo;with the modern Machines I have, why should I even care about this bro?&rdquo;</em>. Thing is once the data grows the time difference would increase exponentially.</p><blockquote><p>Things to Note:</p><ol><li>It&rsquo;s not only about doing it in table, also doing it in best and right possible way.</li><li>Read Documentation.</li></ol></blockquote><h2 id=3-call-q-when-in-trouble>3. Call Q() when in trouble.</h2><p>Let&rsquo;s say I ask you to give the count of the objects which satisifes the following condition.</p><pre><code>(databook_id='A' OR datasheet_id='B') AND (NOT the records which has databook_id='A' and datasheet_id='B')
</code></pre><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=n>databook_condition_objs</span> <span class=o>=</span> <span class=n>Benchmark</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>databook_id</span><span class=o>=</span><span class=s2>&#34;A&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>datasheet_condition_objs</span> <span class=o>=</span> <span class=n>Benchmark</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>datasheet_id</span><span class=o>=</span><span class=s2>&#34;B&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>combined_objects_before_check</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>each_object</span> <span class=ow>in</span> <span class=n>databook_condition_objs</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>combined_objects_before_check</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>each_object</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>each_object</span> <span class=ow>in</span> <span class=n>datasheet_condition_objs</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>combined_objects_before_check</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>each_object</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>combined_objects_after_check</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>each_object</span> <span class=ow>in</span> <span class=n>combined_objects_before_check</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=p>(</span><span class=n>each_object</span><span class=o>.</span><span class=n>databook_id</span> <span class=o>==</span> <span class=s2>&#34;A&#34;</span> <span class=ow>and</span> <span class=n>each_object</span><span class=o>.</span><span class=n>datasheet_id</span> <span class=o>==</span> <span class=s2>&#34;B&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>combined_objects_after_check</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>each_object</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>combined_objects_after_check</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><p>Double query and filter: we can do two queries seperately, iterate through the objects and filter for the <strong>NOT</strong> condition. But this is super expensive and very inefficient.</p><blockquote><p>Performance can be found even in the darkest of times, when one only remembers to read the documentation. - Not Dumbledore.</p></blockquote><p>That&rsquo;s when Q() comes to the rescue. What it does is, it allows us to do complex queries at ease. Q() expression can be coupled with filter() function as well.</p><p><strong>&, |, ~ symbols uses for AND, OR, NOT respectively.</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=n>databook_condition</span> <span class=o>=</span> <span class=n>Q</span><span class=p>(</span><span class=n>databook_id</span><span class=o>=</span><span class=s2>&#34;A&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>datasheet_condition</span> <span class=o>=</span> <span class=n>Q</span><span class=p>(</span><span class=n>datasheet_id</span><span class=o>=</span><span class=s2>&#34;B&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>both_condition</span> <span class=o>=</span> <span class=n>Q</span><span class=p>(</span><span class=n>databook_id</span><span class=o>=</span><span class=s2>&#34;A&#34;</span><span class=p>)</span> <span class=o>&amp;</span> <span class=n>Q</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>datasheet_id</span><span class=o>=</span><span class=s2>&#34;B&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>combined_objects_after_check</span> <span class=o>=</span> <span class=n>Benchmark</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=n>databook_condition</span> <span class=o>|</span> <span class=n>datasheet_condition</span><span class=p>)</span> <span class=o>&amp;</span> <span class=o>~</span><span class=n>both_condition</span>
</span></span><span class=line><span class=cl><span class=p>)</span><span class=o>.</span><span class=n>count</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>combined_objects_after_check</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>What did we get from the Q()?</p><ol><li>Better Performance.</li><li>Better Code readability</li><li>Some Happiness.</li></ol><h2 id=4-what-the-f>4. What The F().</h2><p>Now, let&rsquo;s say you have to update <em>&ldquo;knowledge_end_date&rdquo;</em> of all the rows which has databook_id = &lsquo;A&rsquo;. And you have to update it as <strong>&ldquo;knowlege_begin_date&rdquo; + 12 days</strong>
Let me give a example:</p><p>Before Update:</p><table><thead><tr><th>knowledge_begin_date</th><th>knowledge_end_date</th><th>databook_id</th><th>&mldr;</th></tr></thead><tbody><tr><td>2022-05-13</td><td>NULL</td><td>A</td><td>&mldr;</td></tr><tr><td>2021-01-01</td><td>NULL</td><td>B</td><td>&mldr;</td></tr><tr><td>2022-04-05</td><td>NULL</td><td>A</td><td>&mldr;</td></tr></tbody></table><p>After Update:</p><table><thead><tr><th>knowledge_begin_date</th><th>knowledge_end_date</th><th>databook_id</th><th>&mldr;</th></tr></thead><tbody><tr><td>2022-05-13</td><td>2022-05-25</td><td>A</td><td>&mldr;</td></tr><tr><td>2021-01-01</td><td>NULL</td><td>B</td><td>&mldr;</td></tr><tr><td>2022-04-05</td><td>2022-04-17</td><td>A</td><td>&mldr;</td></tr></tbody></table><p>Bruhhh? You really read this long. Damn your attention span.</p><p>One thing that would come to mind is to fetch all the objects which has databook_id=&lsquo;A&rsquo;, iterate over them, update the <em>knowledge_end_date</em> and calling <em>.save()</em> method on the object. Below is the implementation of it.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=n>objects</span> <span class=o>=</span> <span class=n>Benchmark</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>datasheet_id</span><span class=o>=</span><span class=s2>&#34;A&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>each_object</span> <span class=ow>in</span> <span class=n>objects</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>each_object</span><span class=o>.</span><span class=n>knowledge_end_date</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>each_object</span><span class=o>.</span><span class=n>knowledge_begin_date</span> <span class=o>+</span> <span class=n>timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>each_object</span><span class=o>.</span><span class=n>save</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>This triggers N+1 queries to update N objects. yeah yeah, I hear you, we can do bulk_update() but what If I tell you there is a better way.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=n>Benchmark</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>datasheet_id</span><span class=o>=</span><span class=s2>&#34;A&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>knowledge_end_date</span><span class=o>=</span><span class=n>F</span><span class=p>(</span><span class=s2>&#34;knowledge_begin_date&#34;</span><span class=p>)</span> <span class=o>+</span> <span class=n>timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=mi>10</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><p>This code does the same thing but better. What happens here is F() expression will do the modification within the table without fetching it. Note that, we can only add two things same type. Date + Date or Int + Int and so on. If you try to add Int with Date or String. F() expression will raise exception.</p><blockquote><p>Things to Note:</p><ol><li>Again, Make the Database do the hardwork instead of Python</li><li>F() reduces number of queries and avoids race condition problem, which occurs in the case of iterate and save.</li></ol></blockquote><h2 id=5-iterate-iterate-iterate->5. Iterate, Iterate, Iterate &mldr;</h2><p>Suppose your table grown enormously large. You got into a situation where you need to fetch almost 90% of the data from the table. Next thing, you fire a single query with that condition and blow up your memory.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=n>databook_id</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>benchmark_objects</span> <span class=o>=</span> <span class=n>Benchmark</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>all</span><span class=p>()</span><span class=o>.</span><span class=n>values</span><span class=p>(</span><span class=s2>&#34;databook_id&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>obj</span> <span class=ow>in</span> <span class=n>benchmark_objects</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>databook_ids</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>obj</span><span class=p>[</span><span class=s2>&#34;databook_id&#34;</span><span class=p>])</span>
</span></span></code></pre></td></tr></table></div></div><p>Cool, Now that we have blown up our memory with the above query. Let&rsquo;s &ldquo;Iterate&rdquo;.</p><p>Iterator is something which gives you only a one instant object at any point of time. You cannot revisit the object you have seen before.</p><p>Django supports .iterate() which opens a database connection once and instead of fetching all things at one go, you fetch the objects chunk by chunk. you consume the first chunk of objects and then you move to the next chunk.</p><p>Yes, we are increasing the number of queries here for the advantage of doing things with minimal memory.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>databook_ids</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>benchmark_objects</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>Benchmark</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>all</span><span class=p>()</span><span class=o>.</span><span class=n>values</span><span class=p>(</span><span class=s2>&#34;databook_id&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>iterator</span><span class=p>(</span><span class=n>chunk_size</span><span class=o>=</span><span class=mi>2000</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>obj</span> <span class=ow>in</span> <span class=n>benchmark_objects</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>databook_ids</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>obj</span><span class=p>[</span><span class=s2>&#34;databook_id&#34;</span><span class=p>])</span>
</span></span></code></pre></td></tr></table></div></div><p>Let&rsquo;s say there are <strong>5420 Objects</strong> in your table, <strong>3 Queries</strong> will be fired by the above implementation.</p><p><strong>chunk_size</strong> parmeter helps us to configure, how many objects we need to pick for a query.</p><blockquote><p>Things to Note:</p><ol><li><strong>.iterate()</strong> increases the number of queries you will make, but reduces memory drastically.</li><li>If the roundtrip (time takes to connect to remote database, fetch data, and to return it to you.) is high, consider increasing the chunk_size.</li></ol></blockquote><h2 id=6-index-good-scan-bad>6. index good. scan bad.</h2><p>There is no better magic in database than Indexes. It&rsquo;s the true comuter science marvel. And the easiest place to increase your application performance exponentially.
Suppose if you have index like this,</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=n>indexes</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=n>models</span><span class=o>.</span><span class=n>Index</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>fields</span><span class=o>=</span><span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;client_id&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;-knowledge_end_date&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>models</span><span class=o>.</span><span class=n>Index</span><span class=p>(</span><span class=n>fields</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;client_id&#34;</span><span class=p>,</span> <span class=s2>&#34;databook_id&#34;</span><span class=p>,</span> <span class=s2>&#34;datasheet_id&#34;</span><span class=p>]),</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p>Let&rsquo;s see which Queries will do Index Scan and which Queries won&rsquo;t.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>client_id</span><span class=o>=</span><span class=s1>&#39;1&#39;</span><span class=p>)</span> <span class=c1># Index Scan</span>
</span></span><span class=line><span class=cl><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>client_id</span><span class=o>=</span><span class=s1>&#39;1&#39;</span><span class=p>,</span> <span class=n>databook_id</span><span class=o>=</span><span class=s1>&#39;A&#39;</span><span class=p>)</span> <span class=c1># Index Scan</span>
</span></span><span class=line><span class=cl><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>databook_id</span><span class=o>=</span><span class=s1>&#39;A&#39;</span><span class=p>)</span> <span class=c1># Nopee, Sorry. </span>
</span></span><span class=line><span class=cl><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>datasheet_id</span><span class=o>=</span><span class=s1>&#39;B&#39;</span><span class=p>)</span> <span class=c1># Nopee, Sorry. </span>
</span></span><span class=line><span class=cl><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>client_id</span><span class=o>=</span><span class=s1>&#39;1&#39;</span><span class=p>,</span> <span class=n>databook_id</span><span class=o>=</span><span class=s1>&#39;A&#39;</span><span class=p>,</span><span class=n>datasheet_id</span><span class=o>=</span><span class=s1>&#39;B&#39;</span><span class=p>)</span> <span class=c1># Index Scan</span>
</span></span><span class=line><span class=cl><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=n>client_id</span><span class=o>=</span><span class=s1>&#39;1&#39;</span><span class=p>,</span> <span class=n>datasheet_id</span><span class=o>=</span><span class=s1>&#39;B&#39;</span><span class=p>)</span> <span class=c1># Nope, Sorry.</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>Things to Note:</p><ol><li>Try to se conditions in the filter as same order as the Index.</li><li>Read <a href=https://use-the-index-luke.com/ target=_blank rel="noopener noreffer">https://use-the-index-luke.com/</a>. There is no better site on the Internet which explains Indexes like this.</li></ol></blockquote><p>That&rsquo;s it folks. Thanks for reading till the end! <em>Next time!</em></p><div class=tenor-gif-embed data-postid=12985913 data-share-method=host data-aspect-ratio=1.785 data-width=50%><a href=https://tenor.com/view/the-office-bow-michael-scott-steve-carell-office-gif-12985913>The Office Bow GIF</a>from <a href=https://tenor.com/search/the+office-gifs>The Office GIFs</a></div><script type=text/javascript async src=https://tenor.com/embed.js></script></div></div></div></main></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><link rel=stylesheet href=/lib/lightgallery/lightgallery.min.css><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=stylesheet href=/lib/katex/copy-tex.min.css><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/lunr/lunr.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/twemoji/twemoji.min.js></script><script type=text/javascript src=/lib/lightgallery/lightgallery.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-thumbnail.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-zoom.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript src=/lib/katex/katex.min.js></script><script type=text/javascript src=/lib/katex/auto-render.min.js></script><script type=text/javascript src=/lib/katex/copy-tex.min.js></script><script type=text/javascript src=/lib/katex/mhchem.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:10},comment:{},lightGallery:{actualSize:!1,exThumbImage:"data-thumbnail",hideBarsDelay:2e3,selector:".lightgallery",speed:400,thumbContHeight:80,thumbWidth:80,thumbnail:!0},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrIndexURL:"/index.json",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"lunr"},twemoji:!0}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>